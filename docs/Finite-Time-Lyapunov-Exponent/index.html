<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Lagrangian Coherent Structures: Finite-Time Lyapunov Exponent - Marin Lauber</title>
<meta name="description" content="Computing FTLE fields with Julia">


  <meta name="author" content="Marin Lauber">
  
  <meta property="article:author" content="Marin Lauber">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Marin Lauber">
<meta property="og:title" content="Lagrangian Coherent Structures: Finite-Time Lyapunov Exponent">
<meta property="og:url" content="http://localhost:4000/Finite-Time-Lyapunov-Exponent/">


  <meta property="og:description" content="Computing FTLE fields with Julia">







  <meta property="article:published_time" content="2021-11-12T00:00:00+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/Finite-Time-Lyapunov-Exponent/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Marin Lauber",
      "url": "http://localhost:4000/"
    
  }
</script>


  <meta name="google-site-verification" content="TQx-UZU6AE1OC_AWiWdRAcK2kJDwuiIJBH_Ydjd41oc" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Marin Lauber Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true
        }
      });
      </script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  </head>

  <body class="layout--posts wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Marin Lauber
          <span class="site-subtitle">PhD, Computational Fluid-Structure Interaction</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/Publications/">Publications</a>
            </li><li class="masthead__menu-item">
              <a href="/Research/">Research</a>
            </li><li class="masthead__menu-item">
              <a href="/Gallery/">Gallery</a>
            </li><li class="masthead__menu-item">
              <a href="/Blog/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/CV/Curriculum_Vitae_Marin_Lauber.pdf">CV</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/me.png" alt="Marin Lauber" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Marin Lauber</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>PhD in Fluid-Structure Interaction</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Delft, NL</span>
        </li>
      

      
        
          
            <li><a href="https://marinlauber.gihub.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/MarinLauber" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/marinlauber" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/marin-lauber/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin-in" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:M.Lauber@tudelft.nl">
            <meta itemprop="email" content="M.Lauber@tudelft.nl" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Lagrangian Coherent Structures: Finite-Time Lyapunov Exponent">
    <meta itemprop="description" content="Computing FTLE fields with Julia">
    <meta itemprop="datePublished" content="2021-11-12T00:00:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Lagrangian Coherent Structures: Finite-Time Lyapunov Exponent
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Computing FTLE fields with Julia</p>

<h2 id="introduction">Introduction</h2>

<p>In the study of dynamical systems, Lagrangian Coherent Structures (LCS) are an essential tool to distinguish material surface formed by trajectories that exert a consistent action on nearby trajectories. A classical example of an attracting material surface in dynamical system is called an attractor, see the <a href="https://en.wikipedia.org/wiki/Lorenz_system">Lorenz System</a> for example.</p>

<p>One big advantage of using LCS (or in other words tracking particles trajectories) to analyse dynamical systems is their Galilean invariance, unlike Eulerian criteria.</p>

<p>A common way of determining these LCS is trough ridges of the Finite-time Lyapunov (FTLE). In the following, I will detail how this ridges are computed based on numerical results of a simple flow field.</p>

<h2 id="double-gyre-flow">Double-Gyre flow</h2>

<p>The periodically varying double-gyre flow was discussed in <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.120.439&amp;rep=rep1&amp;type=pdf">Shadden et al. (2005)</a>. It is used as a standard test case for LCS and can be considered a local view of a gulf stream ocean front. It is described by the stream-function</p>

\[\psi(x, y, t) = A\sin(\pi f(x, t)) \sin(\pi y)\]

<p>where</p>

\[f(x, t) = \epsilon\sin(\omega t)x^2 + (1-2\epsilon\sin(\omega t))x,\]

<p>the two component of the time-varying velocity field are then found with the definition of the stream-function $\psi = \nabla\times u$ which gives for a 2D case</p>

\[u = -\frac{\partial \psi}{\partial y}, \qquad v = \frac{\partial \psi}{\partial y}.\]

<p>The flow is defined over a domain $L\times H = [0, 2] \times [0, 1]$, see the animation below</p>

<p><img src="/assets/images/flow.gif" alt="double_gyre" /></p>

<h2 id="computation-of-the-ftle">Computation of the FTLE</h2>

<p>To compute FTLE we start with a standard time-dependent velocity field $\vec u \in \mathbb{R}^n \times T$ and a particle trajectory that satisfies</p>

\[\dot{\vec x}(t) = \vec u(\vec x(t), t).\]

<p>In the following example an analytical solution for the time-dependent velocity field $\vec u$ is provided, but it is much more common that this velocity field is obtained from discrete (in time and space) results of numerical simulations, one must therefore use interpolation to find the value of the velocity field between those points.</p>

<p>To compute the FTLE, the approach is to seed the flow with passive particles with location $X_0 \subset \mathbb{R}^n$. The particle’s trajectories are then advected/intergated forward (or backward) in time from the initial time $t-0$ to the final time $t=T$ to obtain the time-T flow-map defined as</p>

\[\Phi_0^T : \mathbb{R}^n \to \mathbb{R}^n; \quad \vec{x}(0) \to \vec x (0) + \int_{0}^{T} \vec u(\vec x(\tau), \tau)\text{ d}\tau.\]

<p><img src="/assets/images/particles.gif" alt="double_gyre_p" /></p>

<p>Once the flow map is obtained, we can compute the deformation gradient tensor ${\bf D}\Phi_0^T$ of every particle, usually by finite-difference (using  the 2D deformation gradient as an example)</p>

\[{\bf D}\Phi_0^T = \begin{bmatrix}
    \frac{\partial X}{\partial x}  &amp;  \frac{\partial X}{\partial y} \\
     \frac{\partial Y}{\partial x} &amp;  \frac{\partial Y}{\partial y} \\
    \end{bmatrix}
    \sim
    \begin{bmatrix}
    \frac{X_{i+1,j}(T) - X_{i-1,j}(T)}{x_{i+1,j}(0) - x_{i-1,j}(0)}  &amp;  \frac{X_{i+1,j}(T) - X_{i-1,j}(T)}{y_{i+1,j}(0) - y_{i-1,j}(0)} \\
    \frac{Y_{i+1,j}(T) - Y_{i-1,j}(T)}{x_{i+1,j}(0) - x_{i-1,j}(0)} &amp;  \frac{Y_{i+1,j}(T) - Y_{i-1,j}(T)}{x_{i+1,j}(0) - x_{i-1,j}(0)} \\
    \end{bmatrix},\]

<p>where $X$ and $x$ are understood to be Lagrangian and Eulerian variables. The finite-difference approximation assumes that we started with a uniform particles distribution. The deformation grandient measures the amount of stretching a particule experienced during the time interval $T$. Next, the Cauchy-Green deformation tensor can be computed</p>

\[{\bf C}_0^T = ({\bf D}\Phi_0^T)^\top{\bf D}\Phi_0^T,\]

<p>where $(.)^\top$ denote the transpose operator. The maximum amount of stretching experienced by the particle is obtained from maximum eigenvalue $\lambda_{\text{max}}$ of the Cauchy-Green deformation tensor. This is equivalent to performing a singular-value decomposition of this tensor. This is then synthesized into a FTLE field for the time-T flow map</p>

\[\sigma(\Phi_0^T; \vec x_0) = \frac{1}{|T|}\log\sqrt{\lambda_{\text{max}}({\bf C}_0^T(\vec x_0))}\]

<blockquote>
  <p><strong><em>Note:</em></strong> This is the procedure to obtain the FTLE of the time-T flow map, this means that these ridges represent attracting/repeling LCS for particles with initial position $t=0$, for a time-varying velociy field, the FTLE field is obtained by numerous integration of these trajectories with the initial condition varying every time, this can be very expansive!</p>
</blockquote>

<h2 id="numerical-implementation-in-julia">Numerical Implementation in <code class="language-plaintext highlighter-rouge">Julia</code></h2>

<p>First, we start by importing the required libraries, here we need the <code class="language-plaintext highlighter-rouge">LinearAlgebra</code> and <code class="language-plaintext highlighter-rouge">PyPlot</code> libraries, off course you can also use another ploting library if you prefer</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="n">LinearAlgebra</span>
<span class="k">using</span> <span class="n">PyPlot</span>
</code></pre></div></div>

<p>Next we need to define the function <code class="language-plaintext highlighter-rouge">f</code>, the time-varying part of our flow model</p>

\[f(x, t) = \epsilon\sin(\omega t)x^2 + (1-2\epsilon\sin(\omega t))x,\]

<p>which, once transalated to the <code class="language-plaintext highlighter-rouge">Julia</code> language gives</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> f</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="n">t</span><span class="x">,</span> <span class="n">omega</span><span class="x">,</span> <span class="n">epsilon</span><span class="x">)</span>
    <span class="k">return</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">sin</span><span class="x">(</span><span class="n">omega</span><span class="o">*</span><span class="n">t</span><span class="x">)</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="x">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">epsilon</span><span class="o">*</span><span class="n">sin</span><span class="x">(</span><span class="n">omega</span><span class="o">*</span><span class="n">t</span><span class="x">))</span><span class="o">*</span><span class="n">x</span><span class="o">.</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can then define our stream-function based on this function</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> phi</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="n">y</span><span class="x">,</span> <span class="n">t</span><span class="x">,</span> <span class="n">A</span><span class="o">=</span><span class="mf">0.1</span><span class="x">,</span> <span class="n">omega</span><span class="o">=</span><span class="mi">2</span><span class="nb">pi</span><span class="o">/</span><span class="mi">10</span><span class="x">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.2</span><span class="x">)</span>
    <span class="k">return</span> <span class="nd">@.</span> <span class="n">A</span><span class="o">*</span><span class="n">sin</span><span class="x">(</span><span class="nb">pi</span><span class="o">*</span><span class="n">f</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="n">t</span><span class="x">,</span> <span class="n">omega</span><span class="x">,</span> <span class="n">epsilon</span><span class="x">))</span> <span class="o">*</span> <span class="n">sin</span><span class="x">(</span><span class="nb">pi</span><span class="o">*</span><span class="n">y</span><span class="x">)</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p><strong><em>Note:</em></strong> Note here that we must broadcast the results with <code class="language-plaintext highlighter-rouge">@.</code></p>
</blockquote>

<p>As we will generate a mesh of particle and advect it, we must be able to compute the local flow velocity at any point in space and in time, luckily we do not need to interpolate here, we can just compute the value of the velocity at a given location $\vec r = [x, y]$ using the gradient of the stream-function</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> update</span><span class="x">(</span><span class="n">r</span><span class="x">,</span> <span class="n">t</span><span class="x">,</span> <span class="n">Delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="x">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="x">[</span><span class="o">:</span><span class="x">,</span><span class="mi">1</span><span class="x">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="x">[</span><span class="o">:</span><span class="x">,</span><span class="mi">2</span><span class="x">]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="x">(</span><span class="n">phi</span><span class="x">(</span><span class="n">x</span><span class="x">,</span><span class="n">y</span><span class="o">.+</span><span class="n">Delta</span><span class="x">,</span><span class="n">t</span><span class="x">)</span><span class="o">.-</span><span class="n">phi</span><span class="x">(</span><span class="n">x</span><span class="x">,</span><span class="n">y</span><span class="o">.-</span><span class="n">Delta</span><span class="x">,</span><span class="n">t</span><span class="x">))</span><span class="o">./</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Delta</span><span class="x">)</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="x">(</span><span class="n">phi</span><span class="x">(</span><span class="n">x</span><span class="o">.-</span><span class="n">Delta</span><span class="x">,</span><span class="n">y</span><span class="x">,</span><span class="n">t</span><span class="x">)</span><span class="o">.-</span><span class="n">phi</span><span class="x">(</span><span class="n">x</span><span class="o">.+</span><span class="n">Delta</span><span class="x">,</span><span class="n">y</span><span class="x">,</span><span class="n">t</span><span class="x">))</span><span class="o">./</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Delta</span><span class="x">)</span>
    <span class="k">return</span> <span class="x">[</span><span class="o">-</span><span class="n">vx</span> <span class="o">-</span><span class="n">vy</span><span class="x">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Where we have used a standard central difference to esimate the gradient of the stream-function.</p>

<p>Once we have our particle position at time $T$ (I will detail later how to achieve this) we need to compute the local Cauchy-Green deformation tensor. This could be a complex task, but because we will start with a uniform distribution of particles, neighbouring particles are located at neighbouring indices, which makes things much simpler!</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> Jacobian</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="n">y</span><span class="x">,</span> <span class="n">delta</span><span class="x">)</span>
    
    <span class="c"># pre-processing</span>
    <span class="n">nx</span><span class="x">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">size</span><span class="x">(</span><span class="n">x</span><span class="x">)</span>
    <span class="n">J</span> <span class="o">=</span> <span class="kt">Array</span><span class="x">{</span><span class="kt">Float64</span><span class="x">}(</span><span class="nb">undef</span><span class="x">,</span> <span class="mi">2</span><span class="x">,</span> <span class="mi">2</span><span class="x">)</span>
    <span class="n">FTLE</span> <span class="o">=</span> <span class="kt">Array</span><span class="x">{</span><span class="kt">Float64</span><span class="x">}(</span><span class="nb">undef</span><span class="x">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="x">,</span> <span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="x">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="n">∈</span> <span class="mi">1</span><span class="o">:</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="x">,</span> <span class="n">i</span> <span class="n">∈</span> <span class="mi">1</span><span class="o">:</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span>
        
        <span class="c"># jacobian of that particle</span>
        <span class="n">J</span><span class="x">[</span><span class="mi">1</span><span class="x">,</span><span class="mi">1</span><span class="x">]</span> <span class="o">=</span> <span class="x">(</span><span class="n">x</span><span class="x">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="x">,</span><span class="n">j</span><span class="x">]</span><span class="o">-</span><span class="n">x</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="x">])</span><span class="o">/</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="x">)</span>
        <span class="n">J</span><span class="x">[</span><span class="mi">1</span><span class="x">,</span><span class="mi">2</span><span class="x">]</span> <span class="o">=</span> <span class="x">(</span><span class="n">x</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="x">]</span><span class="o">-</span><span class="n">x</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="x">])</span><span class="o">/</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="x">)</span>
        <span class="n">J</span><span class="x">[</span><span class="mi">2</span><span class="x">,</span><span class="mi">1</span><span class="x">]</span> <span class="o">=</span> <span class="x">(</span><span class="n">y</span><span class="x">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="x">,</span><span class="n">j</span><span class="x">]</span><span class="o">-</span><span class="n">y</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="x">])</span><span class="o">/</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="x">)</span>
        <span class="n">J</span><span class="x">[</span><span class="mi">2</span><span class="x">,</span><span class="mi">2</span><span class="x">]</span> <span class="o">=</span> <span class="x">(</span><span class="n">y</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="x">]</span><span class="o">-</span><span class="n">y</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="x">])</span><span class="o">/</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="x">)</span>

        <span class="c"># Green-Cauchy tensor</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">transpose</span><span class="x">(</span><span class="n">J</span><span class="x">)</span><span class="o">.*</span><span class="n">J</span>
        
        <span class="c"># its largest eigenvalue</span>
        <span class="n">lamda</span> <span class="o">=</span> <span class="n">eigvals</span><span class="x">(</span><span class="n">D</span><span class="x">)</span>
        <span class="n">FTLE</span><span class="x">[</span><span class="n">i</span><span class="x">,</span><span class="n">j</span><span class="x">]</span> <span class="o">=</span> <span class="n">maximum</span><span class="x">(</span><span class="n">lamda</span><span class="x">)</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">FTLE</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Alright, now we can start to look at advecting the particle to find their final position. We will use a $4^{th}$-order <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta method</a> to integrate the equation</p>

\[\dot{\vec x}(t) = \vec u(\vec x(t), t) \sim f(\vec x(t), t)\]

<p>from time $t_n$ to $t_{n+1} = t_n + \Delta t$ following</p>

\[\begin{split}
    k_1 &amp;= \Delta t \, f(\vec r_n, t_n)\\
    k_2 &amp;= \Delta t \, f(\vec r_n + 0.5k_1, t_n+0.5\Delta t)\\
    k_3 &amp;= \Delta t \, f(\vec r_n + 0.5k_2, t_n+0.5\Delta t)\\
    k_4 &amp;= \Delta t \, f(\vec r_n + k_3, t_n+\Delta t)\\
    \vec{r}_{n+1} &amp;= (k_1 + 2k_2 + 2k_3 + k_4 ) / 6.
\end{split}\]

<p>We also need to define a grid of particles to advect. Because the edges of the domain have zero velocity, the particles there won’t move so we won’t bother putting particles on the boundary itself</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># number of positions</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">256</span>

<span class="c"># particle position (2D grid)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">collect</span><span class="x">(</span><span class="kt">LinRange</span><span class="x">(</span><span class="mf">0.01</span><span class="x">,</span> <span class="mf">1.99</span><span class="x">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="x">))</span><span class="err">'</span> <span class="o">.*</span> <span class="n">ones</span><span class="x">(</span><span class="n">N</span><span class="x">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">collect</span><span class="x">(</span><span class="kt">LinRange</span><span class="x">(</span><span class="mf">0.01</span><span class="x">,</span> <span class="mf">0.99</span><span class="x">,</span>   <span class="n">N</span><span class="x">))</span>  <span class="o">.*</span> <span class="n">ones</span><span class="x">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="x">)</span><span class="err">'</span><span class="x">;</span>

<span class="c"># particle positions</span>
<span class="n">r</span> <span class="o">=</span> <span class="x">[</span><span class="n">vec</span><span class="x">(</span><span class="n">x</span><span class="x">)</span> <span class="n">vec</span><span class="x">(</span><span class="n">y</span><span class="x">)]</span>
</code></pre></div></div>

<p>Then we can proceed to intergate in time to find the first flow map $\Phi_{0}^{T}$</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># time step</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">collect</span><span class="x">(</span><span class="n">range</span><span class="x">(</span><span class="mi">0</span><span class="x">,</span> <span class="mi">20</span><span class="x">,</span> <span class="n">step</span><span class="o">=</span><span class="n">dt</span><span class="x">))</span>

<span class="c"># intergate in time with RK4</span>
<span class="k">for</span> <span class="n">t</span> <span class="n">∈</span> <span class="n">T</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">update</span><span class="x">(</span><span class="n">r</span><span class="x">,</span> <span class="n">t</span><span class="x">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">update</span><span class="x">(</span><span class="n">r</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="x">,</span> <span class="n">t</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="x">)</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">update</span><span class="x">(</span><span class="n">r</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="x">,</span> <span class="n">t</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="x">)</span>
    <span class="n">k4</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">update</span><span class="x">(</span><span class="n">r</span><span class="o">+</span><span class="n">k3</span><span class="x">,</span> <span class="n">t</span><span class="o">+</span><span class="n">dt</span><span class="x">)</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="x">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="x">)</span> <span class="o">/</span> <span class="mi">6</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The resulting advection of a uniform aprticle grid is shown below, the particles are colored with the instantaneous FTLE values</p>

<p><img src="/assets/images/flow_map.gif" alt="flow_map" /></p>

<p>Once we have integrated this flow map, we can extract the $x$ and $y$ coordinates of each points and compute the FTLE using our <code class="language-plaintext highlighter-rouge">Jacobian</code> function</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># extract position</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">reshape</span><span class="x">(</span><span class="n">r</span><span class="x">[</span><span class="o">:</span><span class="x">,</span><span class="mi">1</span><span class="x">],</span> <span class="n">N</span><span class="x">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="x">);</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">reshape</span><span class="x">(</span><span class="n">r</span><span class="x">[</span><span class="o">:</span><span class="x">,</span><span class="mi">2</span><span class="x">],</span> <span class="n">N</span><span class="x">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="x">);</span>

<span class="c"># compute FTLE</span>
<span class="n">FTLE</span> <span class="o">=</span> <span class="n">Jacobian</span><span class="x">(</span><span class="n">x</span><span class="x">,</span> <span class="n">y</span><span class="x">,</span> <span class="n">r</span><span class="x">[</span><span class="mi">1</span><span class="x">,</span><span class="mi">2</span><span class="x">]</span><span class="o">-</span><span class="n">r</span><span class="x">[</span><span class="mi">1</span><span class="x">,</span><span class="mi">1</span><span class="x">])</span>
<span class="n">FTLE</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="x">(</span><span class="n">FTLE</span><span class="x">);</span>
</code></pre></div></div>

<p>We can the proceed to plot the results</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contour</span><span class="x">(</span><span class="n">FTLE</span><span class="x">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">31</span><span class="x">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">"viridis"</span><span class="x">)</span>
</code></pre></div></div>

<p>Because the flow is time-dependent, we must perform this integartion for every time-step. This means re-generating the array of particle, but now at time $t=\Delta t$, such that we now obtain the flow map $\Phi_{\Delta t}^{T+\Delta t}$, and so on.</p>

<p>Once this is done we can assemble the time-varying FTLE field of the double-gyre flow</p>

<p><img src="/assets/images/Lyapunov.gif" alt="FTLE_double_gyre" /></p>

<p>Areas of high sretching are represented by the sharp green ridges, particules that started at this location experienced a larger stretching than particles that started from bluer regions.</p>

<p>We can notice that because the base flow is periodic, our FTLE field is also periodic.</p>

<h2 id="inspiration">Inspiration</h2>

<p><a href="https://www.youtube.com/watch?v=lveOu7jLNh0">Steve Brunton’s brillant video!</a></p>

<hr />


<!-- <ul class="taxonomy__index">
  
  
    <li>
      <a href="#2021">
        <strong>2021</strong> <span class="taxonomy__count">2</span>
      </a>
    </li>
  
    <li>
      <a href="#2020">
        <strong>2020</strong> <span class="taxonomy__count">4</span>
      </a>
    </li>
  
</ul> -->




  <section id="2021" class="taxonomy__section">
    <h2 class="archive__subtitle">2021</h2>
    <div class="entries-list">
      
        



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Finite-Time-Lyapunov-Exponent/" rel="permalink">Lagrangian Coherent Structures: Finite-Time Lyapunov Exponent
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Computing FTLE fields with Julia
</p>
  </article>
</div>

      
        



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Avdanced-Matplotlib-1/" rel="permalink">Advanced Scientific Matplotlib - Part 1/n
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This series of blog post is here to give some of the tricks I use to produce high-quality figures, suitable for publications.
</p>
  </article>
</div>

      
    </div>
    <a href="#page-title" class="back-to-top">Back to top &uarr;</a>
  </section>

  <section id="2020" class="taxonomy__section">
    <h2 class="archive__subtitle">2020</h2>
    <div class="entries-list">
      
        



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Compact-Poisson-Equation/" rel="permalink">Compact Schemes for the Poisson Equation
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">If you prefer to follow in the notebook directly, you can also get the notebook.
</p>
  </article>
</div>

      
        



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/APS-DFD/" rel="permalink">APS-Division of Fluid Dynamics
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Abstract and video of my talk at APS-DFD 2020
</p>
  </article>
</div>

      
        



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2D-Turbulence/" rel="permalink">Pseudo-spectral method for 2D Turbulence
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Accurate simulation of 2D Turbulence
</p>
  </article>
</div>

      
        



<div class="list__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/HelloWorld/" rel="permalink">My First Post
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Trying all that markdown  has to offers
</p>
  </article>
</div>

      
    </div>
    <a href="#page-title" class="back-to-top">Back to top &uarr;</a>
  </section>


        
      </section>

      <footer class="page__meta">
        
        


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-11-12T00:00:00+01:00">November 12, 2021</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Lagrangian+Coherent+Structures%3A+Finite-Time+Lyapunov+Exponent%20http%3A%2F%2Flocalhost%3A4000%2FFinite-Time-Lyapunov-Exponent%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2FFinite-Time-Lyapunov-Exponent%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2FFinite-Time-Lyapunov-Exponent%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/Avdanced-Matplotlib-1/" class="pagination--pager" title="Advanced Scientific Matplotlib - Part 1/n
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Avdanced-Matplotlib-1/" rel="permalink">Advanced Scientific Matplotlib - Part 1/n
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This series of blog post is here to give some of the tricks I use to produce high-quality figures, suitable for publications.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Compact-Poisson-Equation/" rel="permalink">Compact Schemes for the Poisson Equation
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">If you prefer to follow in the notebook directly, you can also get the notebook.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/APS-DFD/" rel="permalink">APS-Division of Fluid Dynamics
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Abstract and video of my talk at APS-DFD 2020
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2D-Turbulence/" rel="permalink">Pseudo-spectral method for 2D Turbulence
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Accurate simulation of 2D Turbulence
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/MarinLauber" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/marinlauber" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/marin-lauber/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin-in" aria-hidden="true"></i> LinkedIn</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Marin Lauber. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
